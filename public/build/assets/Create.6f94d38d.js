import{u as de,r as s,R as e,H as ue,L as ge,d as Ee}from"./app.17852079.js";import{L as be}from"./Account.d4200037.js";import{S as _}from"./sweetalert2.all.74632f29.js";import"./Dropdown.76421c9c.js";function we(){const{errors:m,transactions:O,statusAnggota:R,biodata:f,provinces:i,cities:u,pengajuans:v}=de().props,Y=O.map(a=>a.status),[J]=s.exports.useState(R.status_anggota),g=Y.toString().replace("[","").replace("]","").replace('"',"").replace('"',""),[t,h]=s.exports.useState(!1),[A,x]=s.exports.useState(""),[w,V]=s.exports.useState(0),[c,z]=s.exports.useState(""),[G,fe]=s.exports.useState(f.id),[K,Q]=s.exports.useState(f.name),[$,X]=s.exports.useState(f.no_anggota),[E,Z]=s.exports.useState(f.province_id),[U,ee]=s.exports.useState(f.city_id),[S,ae]=s.exports.useState(""),[D,te]=s.exports.useState(""),[o,y]=s.exports.useState(""),[N,P]=s.exports.useState(""),[l,W]=s.exports.useState(""),[se,p]=s.exports.useState([]),[B,L]=s.exports.useState(!1),[j,F]=s.exports.useState(!1),C=()=>{const a=new Date().getMonth()+1;return a===4||a===8||a===11},T=()=>new Date().toLocaleString("id-ID",{month:"long"}),le=()=>{if(!v||!v.data)return 0;const a=new Date().getMonth()+1,n=new Date().getFullYear();return v.data.filter(d=>{if(!d||!d.created_at)return!1;const k=new Date(d.created_at);return k.getMonth()+1===a&&k.getFullYear()===n}).length},H=()=>{if(z(T()),g!=="PAID"){h(!1),x("Hanya anggota dengan status PAID yang dapat membuat pengajuan");return}if(!C()){h(!1),x(`Pengajuan mutasi hanya dapat dibuat pada bulan April, Agustus, dan November. Saat ini bulan ${T()}`);return}const a=le();if(V(a),a>=3){h(!1),x(`Anda telah mencapai batas maksimal 3 pengajuan dalam bulan ${T()} ini`);return}h(!0),x("")};s.exports.useEffect(()=>{H()},[v,g]),s.exports.useEffect(()=>{const a=setInterval(()=>{H()},6e4);return()=>clearInterval(a)},[]);const ne=()=>"April, Agustus, dan November",r=(()=>{const a=Math.max(0,3-w);return{current:w,max:3,remaining:a}})(),b=()=>g!=="PAID"?"AKSES DITOLAK":C()?w>=3?"KUOTA HABIS":"BUKA":"TUTUP",I=()=>{switch(b()){case"BUKA":return"success";case"TUTUP":return"danger";case"KUOTA HABIS":return"warning";case"AKSES DITOLAK":return"secondary";default:return"secondary"}},q=()=>{switch(b()){case"BUKA":return"fa-lock-open";case"TUTUP":return"fa-lock";case"KUOTA HABIS":return"fa-ban";case"AKSES DITOLAK":return"fa-user-slash";default:return"fa-lock"}},re=a=>{const n=a.target.value;W(n),n==="dpc"?(y(E),u&&Array.isArray(u)&&p(u.filter(d=>d.province_id==E))):(y(""),p([])),P("")},me=a=>{const n=a.target.value;if(y(n),n&&u&&Array.isArray(u)){const d=u.filter(k=>k.province_id==n);p(d)}else p([]);P("")},ce=async a=>{if(a.preventDefault(),!t){_.fire({title:"Akses Ditolak!",text:A,icon:"error",confirmButtonText:"Mengerti"});return}F(!0);const n={user_id:G,name:K,kta:$,province_id:E,city_id:U,tgl_mutasi:S,keterangan:D,tipe_pindah:l};l==="dpw"?(n.tujuan_mutasi=o,n.dpc_mutasi=N):l==="dpc"&&(n.tujuan_mutasi=E,n.dpc_mutasi=N),Ee.Inertia.post("/account/pengajuan",n,{onSuccess:()=>{_.fire({title:"Success!",text:"Data Pengajuan Anda Sudah Terkirim!",icon:"success",showConfirmButton:!1,timer:2500})},onError:d=>{_.fire({title:"Error!",text:"Terjadi kesalahan saat mengajukan mutasi",icon:"error",confirmButtonText:"Mengerti"})},onFinish:()=>{F(!1)}})},M=()=>{if(!i||!Array.isArray(i))return"DPW Asal";const a=i.find(n=>n.id==E);return a?a.name:"DPW Asal"},ie=()=>{if(!i||!Array.isArray(i))return"DPW Tujuan";const a=i.find(n=>n.id==o);return a?a.name:"DPW Tujuan"},oe=()=>t&&S&&D&&l&&(l==="dpw"&&o&&N||l==="dpc"&&N)&&B;return e.createElement(e.Fragment,null,e.createElement(ue,null,e.createElement("title",null,"User Pengajuan Mutasi - IKATWI")),e.createElement(be,null,!t&&e.createElement("div",{className:"row mb-4 mt-4"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"card border-danger"},e.createElement("div",{className:"card-header bg-danger text-white d-flex justify-content-between align-items-center"},e.createElement("h6",{className:"mb-0"},e.createElement("i",{className:"fas fa-ban me-2"}),"Akses Pengajuan Dibatasi"),e.createElement("span",{className:"badge bg-light text-white"},e.createElement("i",{className:"fas fa-calendar me-1"}),c)),e.createElement("div",{className:"card-body"},e.createElement("div",{className:"alert alert-warning mb-0"},e.createElement("div",{className:"d-flex"},e.createElement("i",{className:"fas fa-exclamation-triangle fa-2x me-3 text-warning"}),e.createElement("div",null,e.createElement("h6",{className:"alert-heading mb-2"},A),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"d-flex align-items-center mb-2"},e.createElement("i",{className:"fas fa-calendar-check text-primary me-2"}),e.createElement("span",null,"Periode Pengajuan: ",e.createElement("strong",null,ne()))),e.createElement("div",{className:"d-flex align-items-center mb-2"},e.createElement("i",{className:"fas fa-clock text-info me-2"}),e.createElement("span",null,"Bulan Saat Ini: ",e.createElement("strong",null,c)))),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"d-flex align-items-center mb-2"},e.createElement("i",{className:"fas fa-chart-bar text-warning me-2"}),e.createElement("span",null,"Batas: ",e.createElement("strong",null,"3 pengajuan per bulan"))),e.createElement("div",{className:"d-flex align-items-center mb-2"},e.createElement("i",{className:"fas fa-chart-pie text-success me-2"}),e.createElement("span",null,"Status: ",e.createElement("strong",{className:`text-${I()}`},b()))))),g!=="PAID"&&e.createElement("div",{className:"mt-2"},e.createElement("small",{className:"text-muted"},"Status anggota Anda saat ini: ",e.createElement("strong",null,J),". Hubungi admin untuk memperbarui status ke PAID."))))))))),g==="PAID"&&e.createElement("div",{className:"row mb-4 mt-4"},e.createElement("div",{className:"col-md-3"},e.createElement("div",{className:"card border-left-primary shadow h-100 py-2"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"row no-gutters align-items-center"},e.createElement("div",{className:"col mr-2"},e.createElement("div",{className:"text-xs font-weight-bold text-primary text-uppercase mb-1"},"Pengajuan ",c),e.createElement("div",{className:"h5 mb-0 font-weight-bold text-gray-800"},w)),e.createElement("div",{className:"col-auto"},e.createElement("i",{className:"fas fa-file-alt fa-2x text-gray-300"})))))),e.createElement("div",{className:"col-md-3"},e.createElement("div",{className:"card border-left-success shadow h-100 py-2"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"row no-gutters align-items-center"},e.createElement("div",{className:"col mr-2"},e.createElement("div",{className:"text-xs font-weight-bold text-success text-uppercase mb-1"},"Sisa Kuota"),e.createElement("div",{className:"h5 mb-0 font-weight-bold text-gray-800"},r.remaining)),e.createElement("div",{className:"col-auto"},e.createElement("i",{className:"fas fa-tachometer-alt fa-2x text-gray-300"})))))),e.createElement("div",{className:"col-md-3"},e.createElement("div",{className:"card border-left-info shadow h-100 py-2"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"row no-gutters align-items-center"},e.createElement("div",{className:"col mr-2"},e.createElement("div",{className:"text-xs font-weight-bold text-info text-uppercase mb-1"},"Status Periode"),e.createElement("div",{className:"h6 mb-0 font-weight-bold text-gray-800"},e.createElement("span",{className:`text-${I()}`},b()))),e.createElement("div",{className:"col-auto"},e.createElement("i",{className:`fas ${q()} fa-2x text-gray-300`})))))),e.createElement("div",{className:"col-md-3"},e.createElement("div",{className:"card border-left-warning shadow h-100 py-2"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"row no-gutters align-items-center"},e.createElement("div",{className:"col mr-2"},e.createElement("div",{className:"text-xs font-weight-bold text-warning text-uppercase mb-1"},"Bulan Saat Ini"),e.createElement("div",{className:"h6 mb-0 font-weight-bold text-gray-800"},c)),e.createElement("div",{className:"col-auto"},e.createElement("i",{className:"fas fa-calendar fa-2x text-gray-300"}))))))),g==="PAID"&&C()&&e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"d-flex justify-content-between align-items-center mb-2"},e.createElement("span",{className:"text-muted"},"Penggunaan kuota pengajuan bulan ",c),e.createElement("span",{className:`badge bg-${r.remaining===0?"danger":"success"}`},r.current," / ",r.max)),e.createElement("div",{className:"progress",style:{height:"10px"}},e.createElement("div",{className:`progress-bar bg-${r.current>=r.max?"danger":"success"}`,role:"progressbar",style:{width:`${r.current/r.max*100}%`},"aria-valuenow":r.current,"aria-valuemin":"0","aria-valuemax":r.max})),e.createElement("small",{className:"text-muted mt-2 d-block"},r.remaining>0?`Anda masih dapat membuat ${r.remaining} pengajuan lagi bulan ${c} ini`:`Anda telah mencapai batas maksimal pengajuan bulan ${c} ini`))))),e.createElement("div",{className:"col-md-12 mt-2"},e.createElement("div",{className:`card border-0 shadow-sm ${t?"":"opacity-75"}`},e.createElement("div",{className:`card-header ${t?"bg-primary":"bg-secondary"} text-white`},e.createElement("div",{className:"d-flex justify-content-between align-items-center"},e.createElement("h5",{className:"card-title mb-0"},e.createElement("i",{className:`fas ${t?"fa-exchange-alt":"fa-lock"} me-2`}),"Form Pengajuan Mutasi",t&&e.createElement("small",{className:"ms-2 opacity-75"},"- Periode ",c," ",b())),t?e.createElement("span",{className:`badge bg-${I()}`},e.createElement("i",{className:`fas ${q()} me-1`}),b()):e.createElement("span",{className:"badge bg-warning"},e.createElement("i",{className:"fas fa-ban me-1"}),"Terkunci"))),e.createElement("div",{className:"card-body"},t&&r.remaining>0&&e.createElement("div",{className:"alert alert-success mb-4"},e.createElement("div",{className:"d-flex align-items-center"},e.createElement("i",{className:"fas fa-check-circle fa-lg me-3 text-success"}),e.createElement("div",null,e.createElement("h6",{className:"alert-heading mb-1"},"Akses Diberikan! - Periode ",c," BUKA"),e.createElement("p",{className:"mb-0"},"Anda dapat membuat pengajuan mutasi. Sisa kuota: ",e.createElement("strong",null,r.remaining," dari ",r.max)," pengajuan bulan ",c,".")))),e.createElement("form",{onSubmit:ce},e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("h6",{className:"text-primary mb-3 border-bottom pb-2"},e.createElement("i",{className:"fas fa-user me-2"}),"Data Diri")),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Nama Lengkap"),e.createElement("input",{type:"text",className:"form-control bg-light",value:K,onChange:a=>Q(a.target.value),disabled:!0}))),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Nomor KTA"),e.createElement("input",{type:"text",className:"form-control bg-light",value:$,onChange:a=>X(a.target.value),disabled:!0})))),e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("h6",{className:"text-primary mb-3 border-bottom pb-2"},e.createElement("i",{className:"fas fa-map-marker-alt me-2"}),"Asal Keanggotaan")),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"DPW Asal"),e.createElement("select",{className:"form-select bg-light",disabled:!0,value:E,onChange:a=>Z(a.target.value)},e.createElement("option",{value:""},"-- Pilih DPW --"),i.map(a=>e.createElement("option",{value:a.id,key:a.id},a.name))))),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"DPC Asal"),e.createElement("select",{className:"form-select bg-light",disabled:!0,value:U,onChange:a=>ee(a.target.value)},e.createElement("option",{value:""},"-- Pilih DPC --"),u.map(a=>e.createElement("option",{value:a.id,key:a.id},a.name)))))),e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("h6",{className:"text-primary mb-3 border-bottom pb-2"},e.createElement("i",{className:"fas fa-file-alt me-2"}),"Data Mutasi")),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Tipe Pindah ",e.createElement("span",{className:"text-danger"},"*")),e.createElement("select",{className:`form-select ${t?"":"bg-light"}`,value:l,onChange:re,required:!0,disabled:!t},e.createElement("option",{value:""},"-- Pilih Tipe Pindah --"),e.createElement("option",{value:"dpw"},"Pindah DPW (Pindah Provinsi)"),e.createElement("option",{value:"dpc"},"Pindah DPC (Pindah Kabupaten/Kota dalam Provinsi yang sama)")),m.tipe_pindah&&e.createElement("div",{className:"alert alert-danger mt-2"},m.tipe_pindah))),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Tanggal Mutasi ",e.createElement("span",{className:"text-danger"},"*")),e.createElement("input",{type:"date",className:`form-control ${t?"":"bg-light"}`,value:S,onChange:a=>ae(a.target.value),placeholder:"Pilih Tanggal Mutasi",required:!0,disabled:!t}),m.tgl_mutasi&&e.createElement("div",{className:"alert alert-danger mt-2"},m.tgl_mutasi)))),e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("h6",{className:"text-primary mb-3 border-bottom pb-2"},e.createElement("i",{className:"fas fa-location-arrow me-2"}),"Tujuan Mutasi")),(l==="dpw"||l==="dpc")&&e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},l==="dpw"?"Tujuan DPW":"DPW"," ",e.createElement("span",{className:"text-danger"},"*")),l==="dpw"?e.createElement("select",{className:`form-select ${t?"":"bg-light"}`,value:o,onChange:me,required:!0,disabled:!t},e.createElement("option",{value:""},"-- Pilih Tujuan DPW --"),i.map(a=>e.createElement("option",{value:a.id,key:a.id},a.name))):e.createElement("input",{type:"text",className:"form-control bg-light",value:M(),disabled:!0}),m.tujuan_mutasi&&e.createElement("div",{className:"alert alert-danger mt-2"},m.tujuan_mutasi))),(l==="dpw"||l==="dpc")&&e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Tujuan DPC ",e.createElement("span",{className:"text-danger"},"*")),e.createElement("select",{className:`form-select ${t?"":"bg-light"}`,value:N,onChange:a=>P(a.target.value),required:!0,disabled:!t||l==="dpw"&&!o},e.createElement("option",{value:""},l==="dpw"&&!o?"-- Pilih DPW terlebih dahulu --":"-- Pilih Tujuan DPC --"),se.map(a=>e.createElement("option",{value:a.id,key:a.id},a.name))),l==="dpw"&&!o&&e.createElement("div",{className:"form-text text-warning"},"Pilih DPW tujuan terlebih dahulu untuk melihat DPC yang tersedia"),m.dpc_mutasi&&e.createElement("div",{className:"alert alert-danger mt-2"},m.dpc_mutasi))),l==="dpc"&&e.createElement("div",{className:"col-12"},e.createElement("div",{className:"alert alert-info"},e.createElement("i",{className:"fas fa-info-circle me-2"}),e.createElement("strong",null,"Informasi:")," Anda melakukan mutasi DPC dalam Provinsi ",e.createElement("strong",null,M()),". Tujuan DPW akan tetap di ",e.createElement("strong",null,M()),".")),l==="dpw"&&o&&e.createElement("div",{className:"col-12"},e.createElement("div",{className:"alert alert-info"},e.createElement("i",{className:"fas fa-info-circle me-2"}),e.createElement("strong",null,"Informasi:")," Anda melakukan mutasi ke Provinsi ",e.createElement("strong",null,ie()),". Pilih DPC tujuan di provinsi tersebut."))),e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("h6",{className:"text-primary mb-3 border-bottom pb-2"},e.createElement("i",{className:"fas fa-sticky-note me-2"}),"Keterangan")),e.createElement("div",{className:"col-12"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Alasan Mutasi ",e.createElement("span",{className:"text-danger"},"*")),e.createElement("textarea",{className:`form-control ${t?"":"bg-light"}`,rows:"4",value:D,onChange:a=>te(a.target.value),placeholder:"Contoh: Mutasi karena pindah tempat kerja, pindah domisili, atau alasan lainnya...",required:!0,disabled:!t}),e.createElement("div",{className:"form-text"},"Jelaskan alasan Anda melakukan mutasi dengan jelas."),m.keterangan&&e.createElement("div",{className:"alert alert-danger mt-2"},m.keterangan)))),e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"card border-warning"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"form-check"},e.createElement("input",{className:"form-check-input",type:"checkbox",required:!0,id:"confirmationCheck",checked:B,onChange:a=>L(a.target.checked),disabled:!t}),e.createElement("label",{className:"form-check-label fw-bold text-warning",htmlFor:"confirmationCheck"},e.createElement("i",{className:"fas fa-exclamation-triangle me-2"}),"Saya menyatakan bahwa data yang saya inputkan adalah benar dan sesuai. Saya bertanggung jawab penuh atas kebenaran data mutasi ini.")))))),e.createElement("div",{className:"row mt-4"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"d-flex gap-2 justify-content-end"},e.createElement(ge,{href:"/account/pengajuan",className:"btn btn-secondary"},e.createElement("i",{className:"fas fa-arrow-left me-2"}),"Kembali"),e.createElement("button",{type:"reset",className:"btn btn-warning",onClick:()=>{W(""),y(""),P(""),p([]),L(!1)},disabled:!t||j},e.createElement("i",{className:"fas fa-redo me-2"}),"Reset"),e.createElement("button",{type:"submit",className:"btn btn-success",disabled:!oe()||j},j?e.createElement(e.Fragment,null,e.createElement("i",{className:"fas fa-spinner fa-spin me-2"}),"Memproses..."):e.createElement(e.Fragment,null,e.createElement("i",{className:"fas fa-paper-plane me-2"}),t?"Ajukan Mutasi":"Akses Ditolak"))))),!t&&e.createElement("div",{className:"row mt-3"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"alert alert-danger"},e.createElement("div",{className:"d-flex align-items-center"},e.createElement("i",{className:"fas fa-lock me-3 fa-lg"}),e.createElement("div",null,e.createElement("h6",{className:"alert-heading mb-1"},"Form Terkunci"),e.createElement("p",{className:"mb-0"},A))))))))))))}export{we as default};
