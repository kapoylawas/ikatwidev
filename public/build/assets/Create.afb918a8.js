import{u as fe,r as t,R as e,H as pe,L as Ne,d as ve}from"./app.43b2bc5a.js";import{L as he}from"./Account.69042d7d.js";import{S as T}from"./sweetalert2.all.3f4997b0.js";import"./Dropdown.544472dd.js";function je(){const{errors:o,transactions:I,statusAnggota:M,biodata:m,provinces:u,cities:d,pengajuans:b}=fe().props;console.log("Provinces:",u),console.log("Cities:",d),console.log("Pengajuans:",b);const _=I&&I.map?I.map(a=>a.status):[],[Z]=t.exports.useState((M==null?void 0:M.status_anggota)||""),f=_&&_.length>0?_.toString().replace("[","").replace("]","").replace('"',"").replace('"',""):"",[r,w]=t.exports.useState(!1),[K,y]=t.exports.useState(""),[p,ee]=t.exports.useState(0),[c,ae]=t.exports.useState(""),[te,xe]=t.exports.useState((m==null?void 0:m.id)||""),[O,ne]=t.exports.useState((m==null?void 0:m.name)||""),[R,se]=t.exports.useState((m==null?void 0:m.no_anggota)||""),[N,le]=t.exports.useState((m==null?void 0:m.province_id)||""),[Y,re]=t.exports.useState((m==null?void 0:m.city_id)||""),[$,me]=t.exports.useState(""),[B,ce]=t.exports.useState(""),[g,S]=t.exports.useState(""),[k,D]=t.exports.useState(""),[l,z]=t.exports.useState(""),[ie,P]=t.exports.useState([]),[J,V]=t.exports.useState(!1),[F,G]=t.exports.useState(!1),U=()=>{const a=new Date().getMonth()+1;return a===4||a===8||a===11},W=()=>new Date().toLocaleString("id-ID",{month:"long"}),A=t.exports.useCallback(()=>{if(!b||!b.data||!Array.isArray(b.data))return 0;const a=new Date().getMonth()+1,s=new Date().getFullYear(),i=b.data.filter(x=>{if(!x||!x.created_at)return!1;try{const C=new Date(x.created_at);return C.getMonth()+1===a&&C.getFullYear()===s}catch(C){return console.error("Error parsing date:",C),!1}}).length;return console.log("Current month submissions count:",i),i},[b]),v=t.exports.useCallback(()=>{const a=W();if(ae(a),f!=="PAID"){w(!1),y("Hanya anggota dengan status PAID yang dapat membuat pengajuan");return}if(!U()){w(!1),y(`Pengajuan mutasi hanya dapat dibuat pada bulan April, Agustus, dan November. Saat ini bulan ${a}`);return}const s=A();if(console.log("Eligibility check - submissions count:",s),ee(s),s>=3){w(!1),y(`Anda telah mencapai batas maksimal 3 pengajuan dalam bulan ${a} ini. Tidak dapat membuat pengajuan baru.`);return}w(!0),y("")},[f,A]);t.exports.useEffect(()=>{v()},[v]),t.exports.useEffect(()=>{const a=setInterval(()=>{v()},6e4);return()=>clearInterval(a)},[v]);const L=()=>"April, Agustus, dan November",n=(()=>{const a=Math.max(0,3-p);return{current:p,max:3,remaining:a}})(),h=()=>f!=="PAID"?"AKSES DITOLAK":U()?p>=3?"KUOTA HABIS":"BUKA":"TUTUP",H=()=>{switch(h()){case"BUKA":return"success";case"TUTUP":return"danger";case"KUOTA HABIS":return"warning";case"AKSES DITOLAK":return"secondary";default:return"secondary"}},Q=()=>{switch(h()){case"BUKA":return"fa-lock-open";case"TUTUP":return"fa-lock";case"KUOTA HABIS":return"fa-ban";case"AKSES DITOLAK":return"fa-user-slash";default:return"fa-lock"}},oe=a=>{if(!r)return;const s=a.target.value;z(s),s==="dpc"?(S(N),d&&Array.isArray(d)&&P(d.filter(i=>i.province_id==N))):(S(""),P([])),D("")},ue=a=>{if(!r)return;const s=a.target.value;if(S(s),s&&d&&Array.isArray(d)){const i=d.filter(x=>x.province_id==s);P(i)}else P([]);D("")},de=async a=>{a.preventDefault();const s=A();if(console.log("Final validation - current count:",s),s>=3){T.fire({title:"Batas Pengajuan Tercapai!",text:`Anda telah mencapai batas maksimal 3 pengajuan dalam bulan ${W()} ini. Tidak dapat membuat pengajuan baru.`,icon:"warning",confirmButtonText:"Mengerti"}),w(!1),y(`Anda telah mencapai batas maksimal 3 pengajuan dalam bulan ${W()} ini`),v();return}if(!r){T.fire({title:"Akses Ditolak!",text:K,icon:"error",confirmButtonText:"Mengerti"});return}G(!0);const i={user_id:te,name:O,kta:R,province_id:N,city_id:Y,tgl_mutasi:$,keterangan:B,tipe_pindah:l};l==="dpw"?(i.tujuan_mutasi=g,i.dpc_mutasi=k):l==="dpc"&&(i.tujuan_mutasi=N,i.dpc_mutasi=k),ve.Inertia.post("/account/pengajuan",i,{onSuccess:()=>{T.fire({title:"Success!",text:"Data Pengajuan Anda Sudah Terkirim!",icon:"success",showConfirmButton:!1,timer:2500}),setTimeout(()=>{v()},1e3)},onError:x=>{T.fire({title:"Error!",text:"Terjadi kesalahan saat mengajukan mutasi",icon:"error",confirmButtonText:"Mengerti"})},onFinish:()=>{G(!1)}})},q=()=>{if(!u||!Array.isArray(u))return"DPW Asal";const a=u.find(s=>s.id==N);return a?a.name:"DPW Asal"},ge=()=>{if(!u||!Array.isArray(u))return"DPW Tujuan";const a=u.find(s=>s.id==g);return a?a.name:"DPW Tujuan"},Ee=()=>!r||A()>=3?!1:$&&B&&l&&(l==="dpw"&&g&&k||l==="dpc"&&k)&&J,j=()=>r?"":"bg-light",E=()=>!r||A()>=3,X=u&&Array.isArray(u)?u:[],be=d&&Array.isArray(d)?d:[];return e.createElement(e.Fragment,null,e.createElement(pe,null,e.createElement("title",null,"User Pengajuan Mutasi - IKATWI")),e.createElement(he,null,!r&&e.createElement("div",{className:"row mb-4 mt-4"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"card border-danger"},e.createElement("div",{className:"card-header bg-danger text-white d-flex justify-content-between align-items-center"},e.createElement("h6",{className:"mb-0"},e.createElement("i",{className:"fas fa-ban me-2"}),"Akses Pengajuan Dibatasi"),e.createElement("span",{className:"badge bg-light text-white"},e.createElement("i",{className:"fas fa-calendar me-1"}),c)),e.createElement("div",{className:"card-body"},e.createElement("div",{className:"alert alert-warning mb-0"},e.createElement("div",{className:"d-flex"},e.createElement("i",{className:"fas fa-exclamation-triangle fa-2x me-3 text-warning"}),e.createElement("div",null,e.createElement("h6",{className:"alert-heading mb-2"},K),e.createElement("div",{className:"row"},e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"d-flex align-items-center mb-2"},e.createElement("i",{className:"fas fa-calendar-check text-primary me-2"}),e.createElement("span",null,"Periode Pengajuan: ",e.createElement("strong",null,L()))),e.createElement("div",{className:"d-flex align-items-center mb-2"},e.createElement("i",{className:"fas fa-clock text-info me-2"}),e.createElement("span",null,"Bulan Saat Ini: ",e.createElement("strong",null,c)))),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"d-flex align-items-center mb-2"},e.createElement("i",{className:"fas fa-chart-bar text-warning me-2"}),e.createElement("span",null,"Batas: ",e.createElement("strong",null,"3 pengajuan per bulan"))),e.createElement("div",{className:"d-flex align-items-center mb-2"},e.createElement("i",{className:"fas fa-chart-pie text-success me-2"}),e.createElement("span",null,"Status: ",e.createElement("strong",{className:`text-${H()}`},h()))))),f!=="PAID"&&e.createElement("div",{className:"mt-2"},e.createElement("small",{className:"text-muted"},"Status anggota Anda saat ini: ",e.createElement("strong",null,Z),". Hubungi admin untuk memperbarui status ke PAID.")),p>=3&&e.createElement("div",{className:"mt-2"},e.createElement("small",{className:"text-danger"},e.createElement("i",{className:"fas fa-info-circle me-1"}),"Anda telah menggunakan semua kuota pengajuan untuk bulan ",c,". Tunggu hingga bulan ",L()," berikutnya untuk membuat pengajuan baru."))))))))),f==="PAID"&&e.createElement("div",{className:"row mb-4 mt-4"},e.createElement("div",{className:"col-md-3"},e.createElement("div",{className:"card border-left-primary shadow h-100 py-2"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"row no-gutters align-items-center"},e.createElement("div",{className:"col mr-2"},e.createElement("div",{className:"text-xs font-weight-bold text-primary text-uppercase mb-1"},"Pengajuan ",c),e.createElement("div",{className:"h5 mb-0 font-weight-bold text-gray-800"},p,"/3")),e.createElement("div",{className:"col-auto"},e.createElement("i",{className:"fas fa-file-alt fa-2x text-gray-300"})))))),e.createElement("div",{className:"col-md-3"},e.createElement("div",{className:"card border-left-success shadow h-100 py-2"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"row no-gutters align-items-center"},e.createElement("div",{className:"col mr-2"},e.createElement("div",{className:"text-xs font-weight-bold text-success text-uppercase mb-1"},"Sisa Kuota"),e.createElement("div",{className:"h5 mb-0 font-weight-bold text-gray-800"},n.remaining)),e.createElement("div",{className:"col-auto"},e.createElement("i",{className:"fas fa-tachometer-alt fa-2x text-gray-300"})))))),e.createElement("div",{className:"col-md-3"},e.createElement("div",{className:"card border-left-info shadow h-100 py-2"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"row no-gutters align-items-center"},e.createElement("div",{className:"col mr-2"},e.createElement("div",{className:"text-xs font-weight-bold text-info text-uppercase mb-1"},"Status Periode"),e.createElement("div",{className:"h6 mb-0 font-weight-bold text-gray-800"},e.createElement("span",{className:`text-${H()}`},h()))),e.createElement("div",{className:"col-auto"},e.createElement("i",{className:`fas ${Q()} fa-2x text-gray-300`})))))),e.createElement("div",{className:"col-md-3"},e.createElement("div",{className:"card border-left-warning shadow h-100 py-2"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"row no-gutters align-items-center"},e.createElement("div",{className:"col mr-2"},e.createElement("div",{className:"text-xs font-weight-bold text-warning text-uppercase mb-1"},"Bulan Saat Ini"),e.createElement("div",{className:"h6 mb-0 font-weight-bold text-gray-800"},c)),e.createElement("div",{className:"col-auto"},e.createElement("i",{className:"fas fa-calendar fa-2x text-gray-300"}))))))),f==="PAID"&&U()&&e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"d-flex justify-content-between align-items-center mb-2"},e.createElement("span",{className:"text-muted"},"Penggunaan kuota pengajuan bulan ",c),e.createElement("span",{className:`badge bg-${n.remaining===0?"danger":n.remaining<=1?"warning":"success"}`},n.current," / ",n.max)),e.createElement("div",{className:"progress",style:{height:"10px"}},e.createElement("div",{className:`progress-bar bg-${n.current>=n.max?"danger":n.current>=2?"warning":"success"}`,role:"progressbar",style:{width:`${n.current/n.max*100}%`},"aria-valuenow":n.current,"aria-valuemin":"0","aria-valuemax":n.max})),e.createElement("small",{className:"text-muted mt-2 d-block"},n.remaining>0?`Anda masih dapat membuat ${n.remaining} pengajuan lagi bulan ${c} ini`:`Anda telah mencapai batas maksimal 3 pengajuan bulan ${c} ini. Tidak dapat membuat pengajuan baru.`),n.current>=3&&e.createElement("div",{className:"alert alert-danger mt-2 mb-0 py-2"},e.createElement("i",{className:"fas fa-exclamation-triangle me-2"}),e.createElement("strong",null,"Batas Tercapai!")," Anda tidak dapat membuat pengajuan baru hingga bulan berikutnya yang diizinkan."))))),e.createElement("div",{className:"col-md-12 mt-2"},e.createElement("div",{className:`card border-0 shadow-sm ${r?"":"opacity-75"}`},e.createElement("div",{className:`card-header ${r?"bg-primary":"bg-secondary"} text-white`},e.createElement("div",{className:"d-flex justify-content-between align-items-center"},e.createElement("h5",{className:"card-title mb-0"},e.createElement("i",{className:`fas ${r?"fa-exchange-alt":"fa-lock"} me-2`}),"Form Pengajuan Mutasi",r&&e.createElement("small",{className:"ms-2 opacity-75"},"- Periode ",c," ",h())),r?e.createElement("span",{className:`badge bg-${H()}`},e.createElement("i",{className:`fas ${Q()} me-1`}),h()):e.createElement("span",{className:"badge bg-warning"},e.createElement("i",{className:"fas fa-ban me-1"}),"Terkunci"))),e.createElement("div",{className:"card-body"},r&&n.remaining>0&&e.createElement("div",{className:"alert alert-success mb-4"},e.createElement("div",{className:"d-flex align-items-center"},e.createElement("i",{className:"fas fa-check-circle fa-lg me-3 text-success"}),e.createElement("div",null,e.createElement("h6",{className:"alert-heading mb-1"},"Akses Diberikan! - Periode ",c," BUKA"),e.createElement("p",{className:"mb-0"},"Anda dapat membuat pengajuan mutasi. Sisa kuota: ",e.createElement("strong",null,n.remaining," dari ",n.max)," pengajuan bulan ",c,".")))),r&&n.remaining===1&&e.createElement("div",{className:"alert alert-warning mb-4"},e.createElement("div",{className:"d-flex align-items-center"},e.createElement("i",{className:"fas fa-exclamation-triangle fa-lg me-3 text-warning"}),e.createElement("div",null,e.createElement("h6",{className:"alert-heading mb-1"},"Kuota Hampir Habis!"),e.createElement("p",{className:"mb-0"},"Ini adalah pengajuan terakhir yang dapat Anda buat bulan ",c," ini.")))),e.createElement("form",{onSubmit:de},e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("h6",{className:"text-primary mb-3 border-bottom pb-2"},e.createElement("i",{className:"fas fa-user me-2"}),"Data Diri")),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Nama Lengkap"),e.createElement("input",{type:"text",className:"form-control bg-light",value:O,onChange:a=>ne(a.target.value),disabled:!0}))),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Nomor KTA"),e.createElement("input",{type:"text",className:"form-control bg-light",value:R,onChange:a=>se(a.target.value),disabled:!0})))),e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("h6",{className:"text-primary mb-3 border-bottom pb-2"},e.createElement("i",{className:"fas fa-map-marker-alt me-2"}),"Asal Keanggotaan")),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"DPW Asal"),e.createElement("select",{className:"form-select bg-light",disabled:!0,value:N,onChange:a=>le(a.target.value)},e.createElement("option",{value:""},"-- Pilih DPW --"),X.map(a=>e.createElement("option",{value:a.id,key:a.id},a.name))))),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"DPC Asal"),e.createElement("select",{className:"form-select bg-light",disabled:!0,value:Y,onChange:a=>re(a.target.value)},e.createElement("option",{value:""},"-- Pilih DPC --"),be.map(a=>e.createElement("option",{value:a.id,key:a.id},a.name)))))),e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("h6",{className:"text-primary mb-3 border-bottom pb-2"},e.createElement("i",{className:"fas fa-file-alt me-2"}),"Data Mutasi")),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Tipe Pindah ",e.createElement("span",{className:"text-danger"},"*")),e.createElement("select",{className:`form-select ${j()}`,value:l,onChange:oe,required:!0,disabled:E()},e.createElement("option",{value:""},"-- Pilih Tipe Pindah --"),e.createElement("option",{value:"dpw"},"Pindah DPW (Pindah Provinsi)"),e.createElement("option",{value:"dpc"},"Pindah DPC (Pindah Kabupaten/Kota dalam Provinsi yang sama)")),o.tipe_pindah&&e.createElement("div",{className:"alert alert-danger mt-2"},o.tipe_pindah))),e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Tanggal Mutasi ",e.createElement("span",{className:"text-danger"},"*")),e.createElement("input",{type:"date",className:`form-control ${j()}`,value:$,onChange:a=>me(a.target.value),placeholder:"Pilih Tanggal Mutasi",required:!0,disabled:E()}),o.tgl_mutasi&&e.createElement("div",{className:"alert alert-danger mt-2"},o.tgl_mutasi)))),e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("h6",{className:"text-primary mb-3 border-bottom pb-2"},e.createElement("i",{className:"fas fa-location-arrow me-2"}),"Tujuan Mutasi")),(l==="dpw"||l==="dpc")&&e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},l==="dpw"?"Tujuan DPW":"DPW"," ",e.createElement("span",{className:"text-danger"},"*")),l==="dpw"?e.createElement("select",{className:`form-select ${j()}`,value:g,onChange:ue,required:!0,disabled:E()},e.createElement("option",{value:""},"-- Pilih Tujuan DPW --"),X.map(a=>e.createElement("option",{value:a.id,key:a.id},a.name))):e.createElement("input",{type:"text",className:"form-control bg-light",value:q(),disabled:!0}),o.tujuan_mutasi&&e.createElement("div",{className:"alert alert-danger mt-2"},o.tujuan_mutasi))),(l==="dpw"||l==="dpc")&&e.createElement("div",{className:"col-md-6"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Tujuan DPC ",e.createElement("span",{className:"text-danger"},"*")),e.createElement("select",{className:`form-select ${j()}`,value:k,onChange:a=>D(a.target.value),required:!0,disabled:E()||l==="dpw"&&!g},e.createElement("option",{value:""},l==="dpw"&&!g?"-- Pilih DPW terlebih dahulu --":"-- Pilih Tujuan DPC --"),ie.map(a=>e.createElement("option",{value:a.id,key:a.id},a.name))),l==="dpw"&&!g&&e.createElement("div",{className:"form-text text-warning"},"Pilih DPW tujuan terlebih dahulu untuk melihat DPC yang tersedia"),o.dpc_mutasi&&e.createElement("div",{className:"alert alert-danger mt-2"},o.dpc_mutasi))),l==="dpc"&&e.createElement("div",{className:"col-12"},e.createElement("div",{className:"alert alert-info"},e.createElement("i",{className:"fas fa-info-circle me-2"}),e.createElement("strong",null,"Informasi:")," Anda melakukan mutasi DPC dalam Provinsi ",e.createElement("strong",null,q()),". Tujuan DPW akan tetap di ",e.createElement("strong",null,q()),".")),l==="dpw"&&g&&e.createElement("div",{className:"col-12"},e.createElement("div",{className:"alert alert-info"},e.createElement("i",{className:"fas fa-info-circle me-2"}),e.createElement("strong",null,"Informasi:")," Anda melakukan mutasi ke Provinsi ",e.createElement("strong",null,ge()),". Pilih DPC tujuan di provinsi tersebut."))),e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("h6",{className:"text-primary mb-3 border-bottom pb-2"},e.createElement("i",{className:"fas fa-sticky-note me-2"}),"Keterangan")),e.createElement("div",{className:"col-12"},e.createElement("div",{className:"mb-3"},e.createElement("label",{className:"form-label fw-bold"},"Alasan Mutasi ",e.createElement("span",{className:"text-danger"},"*")),e.createElement("textarea",{className:`form-control ${j()}`,rows:"4",value:B,onChange:a=>ce(a.target.value),placeholder:"Contoh: Mutasi karena pindah tempat kerja, pindah domisili, atau alasan lainnya...",required:!0,disabled:E()}),e.createElement("div",{className:"form-text"},"Jelaskan alasan Anda melakukan mutasi dengan jelas."),o.keterangan&&e.createElement("div",{className:"alert alert-danger mt-2"},o.keterangan)))),e.createElement("div",{className:"row mb-4"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"card border-warning"},e.createElement("div",{className:"card-body"},e.createElement("div",{className:"form-check"},e.createElement("input",{className:"form-check-input",type:"checkbox",required:!0,id:"confirmationCheck",checked:J,onChange:a=>V(a.target.checked),disabled:E()}),e.createElement("label",{className:"form-check-label fw-bold text-warning",htmlFor:"confirmationCheck"},e.createElement("i",{className:"fas fa-exclamation-triangle me-2"}),"Saya menyatakan bahwa data yang saya inputkan adalah benar dan sesuai. Saya bertanggung jawab penuh atas kebenaran data mutasi ini.")))))),e.createElement("div",{className:"row mt-4"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"d-flex gap-2 justify-content-end"},e.createElement(Ne,{href:"/account/pengajuan",className:"btn btn-secondary"},e.createElement("i",{className:"fas fa-arrow-left me-2"}),"Kembali"),e.createElement("button",{type:"reset",className:"btn btn-warning",onClick:()=>{z(""),S(""),D(""),P([]),V(!1)},disabled:E()||F},e.createElement("i",{className:"fas fa-redo me-2"}),"Reset"),e.createElement("button",{type:"submit",className:"btn btn-success",disabled:!Ee()||F||E()},F?e.createElement(e.Fragment,null,e.createElement("i",{className:"fas fa-spinner fa-spin me-2"}),"Memproses..."):e.createElement(e.Fragment,null,e.createElement("i",{className:"fas fa-paper-plane me-2"}),r?"Ajukan Mutasi":"Akses Ditolak"))))),!r&&e.createElement("div",{className:"row mt-3"},e.createElement("div",{className:"col-12"},e.createElement("div",{className:"alert alert-danger"},e.createElement("div",{className:"d-flex align-items-center"},e.createElement("i",{className:"fas fa-lock me-3 fa-lg"}),e.createElement("div",null,e.createElement("h6",{className:"alert-heading mb-1"},"Form Terkunci"),e.createElement("p",{className:"mb-0"},K),p>=3&&e.createElement("p",{className:"mb-0 mt-2"},e.createElement("strong",null,"Solusi:")," Tunggu hingga bulan ",L()," berikutnya untuk membuat pengajuan baru."))))))))))))}export{je as default};
